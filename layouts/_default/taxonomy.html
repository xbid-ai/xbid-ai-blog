{{ define "main" }}
<main class="main" id="main">
  <article class="post-single">

    <!-- Author header -->
    <header class="post-header">
      {{/* build socials from simple fields */}}
      {{- $icons := slice -}}
      {{- with .Params.github -}}
        {{- $g := replaceRE "^@+" "" (printf "%v" .) -}}
        {{- $u := cond (hasPrefix $g "http") $g (printf "https://github.com/%s" $g) -}}
        {{- $icons = $icons | append (dict "name" "github" "url" $u) -}}
      {{- end -}}
      {{- with .Params.instagram -}}
        {{- $g := replaceRE "^@+" "" (printf "%v" .) -}}
        {{- $u := cond (hasPrefix $g "http") $g (printf "https://instagram.com/%s" $g) -}}
        {{- $icons = $icons | append (dict "name" "instagram" "url" $u) -}}
      {{- end -}}
      {{- with .Params.youtube -}}
        {{- $g := replaceRE "^@+" "" (printf "%v" .) -}}
        {{- $u := cond (hasPrefix $g "http") $g (printf "https://youtube.com/@%s" $g) -}}
        {{- $icons = $icons | append (dict "name" "youtube" "url" $u) -}}
      {{- end -}}
      {{- with (or .Params.x .Params.twitter) -}}
        {{- $h := replaceRE "^@+" "" (printf "%v" .) -}}
        {{- $u := cond (hasPrefix $h "http") $h (printf "https://x.com/%s" $h) -}}
        {{- $icons = $icons | append (dict "name" "x" "url" $u "title" "X") -}}
      {{- end -}}
      {{- with (or .Params.website .Params.site .Params.url) -}}
        {{- $w := printf "%v" . -}}
        {{- $u := cond (hasPrefix $w "http") $w (printf "https://%s" $w) -}}
        {{- $icons = $icons | append (dict "name" "website" "url" $u "title" "Website") -}}
      {{- end -}}
      {{- with .Params.email -}}
        {{- $u := cond (hasPrefix . "mailto:") . (printf "mailto:%s" .) -}}
        {{- $icons = $icons | append (dict "name" "email" "url" $u "title" "Email") -}}
      {{- end }}

      <div style="display:flex;gap:1rem;align-items:flex-start;">
        {{ $avatar := or .Params.avatar .Params.image }}
        {{ if $avatar }}
          <img src="{{ $avatar }}" alt="{{ .Title }}" width="70" height="70"
               style="border-radius:50%;object-fit:cover;margin-top:10px;">
        {{ end }}
        <div>
          <h2 class="post-title" style="margin:0;">{{ .Title }}</h2>

          {{ $short := .Params.bio_short | default .Params.bio }}
          {{ $full := .Params.bio_full }}

          <div class="bio-container" style="margin:.25rem 0 0 0;max-width:620px;">
           <input type="checkbox"
              id="bioToggle-{{ with .File }}{{ .UniqueID }}{{ else }}{{ .Title | urlize }}{{ end }}"
              class="bio-toggle">

            <div class="bio-short">
              {{ $short | markdownify }}
              {{ if $full }}
              <label class="bio-more"
                for="bioToggle-{{ with .File }}{{ .UniqueID }}{{ else }}{{ .Title | urlize }}{{ end }}">
                Read More
              </label>
              {{ end }}
            </div>

            {{ if $full }}
            <div class="bio-full">
              {{ $full | markdownify }}
              <label class="bio-less"
                for="bioToggle-{{ with .File }}{{ .UniqueID }}{{ else }}{{ .Title | urlize }}{{ end }}">
                Show Less
              </label>
            </div>
            {{ end }}
          </div>
          {{/* END EXPANDER */}}

          {{ if gt (len $icons) 0 }}
            <div class="social-icons" style="display:flex;gap:.1rem;margin-top:1rem;align-items:center;">
              {{ range $icons }}
                <a href="{{ trim .url " " | safeURL }}" target="_blank" rel="noopener noreferrer me"
                   title="{{ (.title | default .name) | title }}">
                  {{ partial "svg.html" . }}
                </a>
              {{ end }}
            </div>
          {{ end }}
        </div>
      </div>
    </header>

    {{ with .Content }}
      <div class="post-content" style="margin-top:1rem;">
        {{ . }}
      </div>
    {{ end }}

    <h2 style="margin-top:2rem;">Posts</h2>
    <br/>
    <div class="post-entry-list">
      {{ range .Pages.ByDate.Reverse }}
        <article class="post-entry">
          <header class="entry-header">
            <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
          </header>
          {{ with .Summary }}
            <div class="entry-content">{{ . }}</div>
          {{ end }}
          <footer class="entry-footer">
            <span>{{ .Date.Format "January 2, 2006" }}</span>
          </footer>
        </article>
      {{ end }}
    </div>

  </article>
</main>
{{ end }}
